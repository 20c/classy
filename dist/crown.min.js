(function(){crown={make_name:function(a){var c=a.split(/[-\s]/);for(a=0;a<c.length;a++)0<a&&(c[a]=c[a].charAt(0).toUpperCase()+c[a].slice(1));return c.join("")},define:function(a,c){var e;a=crown.make_name(a);if("function"==typeof c[a]){var d=c[a];delete c[a]}else d=function(){};for(e in c)d.prototype[e]=c[e];d.prototype._meta={name:a};return d},fork:function(a,c,e){var d,g,b;a=crown.make_name(a);"function"==typeof e&&(e=[e]);if("function"==typeof c[a]){var f=c[a];delete c[a]}else f=1==e.length?function(){e[0].apply(this,
arguments)}:function(){};for(g in e)if(b=e[g]){for(d in b.prototype)f.prototype[d]=b.prototype[d],"function"==typeof b.prototype[d]&&(f.prototype[b.prototype._meta.name+"_"+d]=b.prototype[d]);for(d in c)f.prototype[d]=c[d];f.prototype[b.prototype._meta.name]=b}f.prototype._meta={name:a,parents:e};return f},override:function(a,c,e){a.prototype[c]&&(a.prototype[a.prototype._meta.name+"_"+c]=a.prototype[c]);a.prototype[c]=e},util:{concat_array:function(){var a=[],c,e,d;for(d=0;d<arguments.length;d++)if(c=
arguments[d],void 0!==c)if("object"==typeof c&&c.length)for(e=0;e<c.length;e++)a.push(c[e]);else a.push(c);return a}},define_or_fork:function(a,c,e){return a&&c?e?crown.fork(a,c,e):crown.define(a,c):function(){}},space:function(a,c,e,d,g){rv={$meta:{cls:crown.define_or_fork(a,c,d),space:e,name:a,definition:c},$init:function(){function a(c,b){return c.apply(this,b)}a.prototype=this.$meta.cls.prototype;return new a(this.$meta.cls,arguments)},$define:function(a,c,b){var e=[];if("object"==typeof b&&b.length){var d;
for(d=0;d<b.length;d++)b[d]&&b[d].$meta&&e.push(b[d]),b[d]=b[d]&&b[d].$meta?b[d].$meta.cls:b[d]}else b&&b.$meta&&(e.push(b),b=[b.$meta.cls]);this[a]=crown.space(a,c,this,b,e)},$fork:function(a,b,c,d){(d||this.$meta.space).$define(a,b,crown.util.concat_array(this,c))},$extend:function(a){for(var b in a)crown.override(this.$meta.cls,b,a[b])}};var b,f;a=rv.$meta.cls;if(g&&0<g.length)for(b in g)for(f in g[b])"$"==f.charAt(0)&&"$meta"!=f&&"$define"!=f&&"$fork"!=f&&"$extend"!=f&&"$init"!=f&&("function"==
typeof g[b][f]?(rv.$meta.cls.prototype[f]=g[b][f].bind(rv),rv[f]=g[b][f]):rv.$meta.cls.prototype[f]=rv[f]=g[b][f]);for(b in c)"$"==b.charAt(0)&&(rv[b]&&d&&(rv[d.prototype._meta.name+"_"+b]=d[b]),rv[b]=c[b],a&&a.prototype[b].bind&&(a.prototype[b]=a.prototype[b].bind(rv)));a&&a.prototype._meta&&(a.prototype._meta.crown=rv);return rv}}})();
